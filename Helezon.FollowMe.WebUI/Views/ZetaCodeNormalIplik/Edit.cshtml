@model Helezon.FollowMe.WebUI.Models.ViewModels.ZetaCodeNormalIplikVm

@{
    ViewBag.Title = "";
    var update = string.Equals(Model.Operation, "update", StringComparison.InvariantCultureIgnoreCase);
}


<form action="@(update ? "/ZetaCodeNormalIplik/Edit" : "/ZetaCodeNormalIplik/Create")" id="frmZetaCodeNormalIplik" method="post">
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.ZetaCodeNormalIplikDto.Id)
    <div class="portlet box green">
        <div class="portlet-title">
            <div class="caption">
                <i class="fa fa-gift"></i>Zeta Code Normal İplik [Create or Edit Page]
            </div>
            <div class="tools">
            </div>
        </div>
        <div class="portlet-body">
            <div class="panel-group accordion" id="accordion1">
                @Html.Partial("_Edit", model: Model, viewData: ViewData)
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapse_3"> Group #3 </a>
                        </h4>
                    </div>
                    <div id="collapse_3" class="panel-collapse in">
                        <div class="panel-body">
                            <div class="portlet box red">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="fa fa-gift"></i> İplik No Repeating Form
                                    </div>
                                    <div class="tools">
                                        <a href="javascript:;" class="collapse"> </a>
                                        <a href="#portlet-config" data-toggle="modal" class="config"> </a>
                                        <a href="javascript:;" class="reload"> </a>
                                        <a href="javascript:;" class="remove"> </a>
                                    </div>
                                </div>
                                <div class="portlet-body form">
                                    <div class="form-body">
                                        <div class="form-group">
                                            <div class="mt-repeater form-horizontal">
                                                <h3 class="mt-repeater-title">İplik No</h3>
                                                <div data-repeater-list="IplikNoDtos">
                                                    @{
                                                        foreach (var iplikNo in Model.ZetaCodeNormalIplikDto.IplikNo)
                                                        {
                                                            <text>
                                                                <div data-repeater-item class="mt-repeater-item">
                                                                    <!-- jQuery Repeater Container -->
                                                                    <div class="mt-repeater-input">
                                                                        <div class="panel panel-default">
                                                                            <div class="panel-body" style="height:200px; overflow-y:auto;">
                                                                                <label class="control-label">Elyaf Cinsi Kalitesi</label>
                                                                                <br />
                                                                                <input type="text" name="ElyafCinsiKalitesi" id="ElyafCinsiKalitesi" class="form-control" value="@iplikNo.ElyafCinsiKalitesi" />
                                                                                <div id="treeElyafCinsiKalitesi"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <label class="control-label">NE</label>
                                                                        <br />
                                                                        @Html.DropDownList("Ne", Model.NE(iplikNo.Ne), "Please Select", htmlAttributes: new { @class = "form-control"})
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <label class="control-label">NM</label>
                                                                        <br />
                                                                        @Html.DropDownList("Ne", Model.NM(iplikNo.Nm), "Please Select", htmlAttributes: new { @class = "form-control" })
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <label class="control-label">DNY</label>
                                                                        <br />
                                                                        @Html.DropDownList("Ne", Model.DYN(iplikNo.Dny), "Please Select", htmlAttributes: new { @class = "form-control" })
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <label class="control-label">FL</label>
                                                                        <br />
                                                                        @Html.DropDownList("Fl", Model.FL(iplikNo.Fl), "Please Select", htmlAttributes: new { @class = "form-control" })
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <label class="control-label">EA</label>
                                                                        <br />
                                                                        @Html.DropDownList("Ea", Model.EA(iplikNo.Ea), "Please Select", htmlAttributes: new { @class = "form-control" })
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <label class="control-label">Eltaf Oranı</label>
                                                                        <br />
                                                                        @Html.DropDownList("Ne", Model.ElyafOrani(iplikNo.ElyafOrani), "Please Select", htmlAttributes: new { @class = "form-control" })
                                                                    </div>
                                                                    <div class="mt-repeater-input">
                                                                        <a href="javascript:;" data-repeater-delete class="btn btn-danger mt-repeater-delete">
                                                                            <i class="fa fa-close"></i> Delete
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                <hr />
                                                            </text>
                                                        }

                                                    }



                                                </div>
                                                <a href="javascript:;" data-repeater-create class="btn btn-success mt-repeater-add">
                                                    <i class="fa fa-plus"></i> Add
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="form-horizontal form-bordered form-row-stripped">
                            <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-offset-2 col-md-10">
                                        <button type="submit" onclick="validateSomeFields()" class="btn green">
                                            @*<i class="fa fa-pencil"></i>*@ Submit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</form>


<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section afterGlobalScripts {

    <script>
        $("#frmZetaCodeNormalIplik").submit(function (event) {

            //if (($("#ZetaCodeNormalIplikDto_BlueSiparisNo").val() * 1) < 1) {
            //    alert("Sipariş  No Oluşturulamadı");
            //    event.preventDefault();
            //}
         
        });

        function setHtmlColorCode(dll) {       
            var htmlColorText = dll.find("option:selected").text();
            if (htmlColorText.length > 0) {
                dll.closest(".form-group").find("#renkidhtml").css('background-color', htmlColorText.split("|")[1]);
            }

           
        }

        var modulZetaCodeNormalIplikVm = (function () {

            var ajaxTreeFillTermTree = function (selector, url, valueElement) {
                var tmp = $(selector).jstree(true);
                if (tmp) {
                    tmp.destroy();
                }
                $(selector).jstree({
                    'plugins': ['search', 'checkbox', 'wholerow'],
                    'core': {
                        "multiple": false,
                        'data': {
                            'url': function (node) {
                                return url;
                            }
                            //,
                            //'data': function (node) {
                            //    //console.log(node);

                            //    return { 'parent': node.id };
                            //}
                        },
                        'animation': false,
                        //'expand_selected_onload': true,
                        'themes': {
                            'icons': false,
                        }
                    },
                    'search': {
                        'show_only_matches': true,
                        'show_only_matches_children': true
                    },
                    'checkbox': {
                        'keep_selected_style': false,
                        'three_state': false,
                        'cascade': ''
                    }
                });

                $(selector).on('changed.jstree',
                    function (e, data) {
                        var i, j, ids = [], texts = [];
                        for (i = 0, j = data.selected.length; i < j; i++) {
                            var node = data.instance.get_node(data.selected[i]);
                            ids.push(node.id);
                            //texts.push(node.text);
                        }
                        var txtElyafCinsiKalitesi = $(selector).closest(".panel-body").find(valueElement);
                        txtElyafCinsiKalitesi.empty();
                        //$(txtElyafCinsiKalitesi).val(texts.join(', '));
                        $(txtElyafCinsiKalitesi).val(ids.join(', '));
                        

                });
            };


            var repeater = function () {
                $('.mt-repeater').each(function () {
                    $(this).repeater({
                        show: function () {
                            $(this).slideDown();

                            ajaxTreeFillTermTreeRef($(this).find("#treeElyafCinsiKalitesi"), "/ZetaCodeNormalIplik/JSTreeElyafCinsiveKalitesi");

                            //modulZetaCodeNormalIplikVm.ajaxTreeFillTermTree("#treeElyafCinsiKalitesi", "/ZetaCodeNormalIplik/JSTreeElyafCinsiveKalitesi");            


                            //$('.date-picker').datepicker({
                            //    rtl: App.isRTL(),
                            //    orientation: "left",
                            //    autoclose: true
                            //});
                        },

                        hide: function (deleteElement) {
                            if (confirm('Are you sure you want to delete this element?')) {
                                $(this).slideUp(deleteElement);
                            }
                        },

                        ready: function (setIndexes) {


                        },
                        isFirstItemUndeletable: false

                    });
                })
            };

            var ajaxTreeFillTermTreeRef = function (selector, url) {
                var tmp = selector.jstree(true);
                if (tmp) {
                    tmp.destroy();
                }
                selector.jstree({
                    'plugins': ['search', 'checkbox', 'wholerow'],
                    'core': {
                        "multiple": false,
                        'data': {
                            'url': function (node) {
                                return url;
                            },
                            //'data': function (node) {
                            //    //console.log(node);

                            //    return { 'parent': node.id };
                            //}
                        },
                        'animation': false,
                        //'expand_selected_onload': true,
                        'themes': {
                            'icons': false,
                        }
                    },
                    'search': {
                        'show_only_matches': true,
                        'show_only_matches_children': true
                    },
                    'checkbox': {
                        'keep_selected_style': false,
                        'three_state': false,
                        'cascade': ''
                    }
                });

                selector.on('changed.jstree',
                    function (e, data) {
                        var i, j, ids = [], texts = [];
                        for (i = 0, j = data.selected.length; i < j; i++) {
                            var node = data.instance.get_node(data.selected[i]);
                            ids.push(node.id);
                            //texts.push(node.text);
                        }
                        var txtElyafCinsiKalitesi = $(selector).closest(".panel-body").find("#ElyafCinsiKalitesi");
                        txtElyafCinsiKalitesi.empty();
                        //$(txtElyafCinsiKalitesi).val(texts.join(', '));
                        $(txtElyafCinsiKalitesi).val(ids.join(', '));


                    });


            };




            return {

                ajaxTreeFillTermTree: ajaxTreeFillTermTree,
                ajaxTreeFillTermTreeRef: ajaxTreeFillTermTreeRef,
                repeater: repeater
            };

        })();




    </script>

    <script>

        function getBlueCompanyData(dll) {

            if (dll.val().length > 0) {
                var jqXHR = $.ajax({
                    type: "POST",
                    url: "/ZetaCodeNormalIplik/GetBlueCompanyData",
                    data: {
                        "companyId": dll.val()                  
                    }
                }).done(function (response, status, jqXHR) {
                    //console.log(data);
                    //$('#Code').val(data);
                    //$("#container").html(data);
                    if (response.SuccessMessage.length !== 0) {                      

                        $("#ZetaCodeNormalIplikDto_BlueKod").val(response.Data.BlueCode);
                        $("#ZetaCodeNormalIplikDto_BlueSiparisNo").val(response.Data.SiparisNo);
                       
                    } else {
                        alert(response.ErrorMessage);
                    }
                    //console.log(typeof data);
                    //console.log(data);
                    //if (data.IsSucceeded) {
                    //    swal("Success.", 'Taxonomy Saved.', "success");
                    //} else {
                    //    swal("Error!", data.Message, "error");
                    //}
                }).fail(function (jqXHR, status, err) {
                    swal("Error!", err + '', "error");
                }).always(function () {
                    App.unblockUI();
                });
            }

        }

        $(document).ready(function () {
            modulZetaCodeNormalIplikVm.ajaxTreeFillTermTree("#treeIplikKategosiId", "/ZetaCodeNormalIplik/JSTreeIplikKategoriler","#ZetaCodeNormalIplikDto_IplikKategosiId");
            modulZetaCodeNormalIplikVm.ajaxTreeFillTermTree("#treeUretimTeknolojisiId", "/ZetaCodeNormalIplik/JSTreeUretimTeknolojisi","#ZetaCodeNormalIplikDto_UretimTeknolojisiId");
            modulZetaCodeNormalIplikVm.ajaxTreeFillTermTree("#treeElyafCinsiKalitesi", "/ZetaCodeNormalIplik/JSTreeElyafCinsiveKalitesi", "#ElyafCinsiKalitesi");            
            modulZetaCodeNormalIplikVm.ajaxTreeFillTermTree("#treeRafyeriTurkiyeId", "/ZetaCodeNormalIplik/JSTreeRafyeriTurkiyeId", "#ZetaCodeNormalIplikDto_RafyeriTurkiyeId");            
            modulZetaCodeNormalIplikVm.ajaxTreeFillTermTree("#treeRafyeriYunanistanId", "/ZetaCodeNormalIplik/JSTreeRafyeriYunanistanId", "#ZetaCodeNormalIplikDto_RafyeriYunanistanId");            


            modulZetaCodeNormalIplikVm.repeater();

        });
    </script>





    @Scripts.Render("~/bundles/jqueryval")
}
